require 'spec'
require 'uri'
require 'carrot'
require "lib/masstransit"

describe "RabbitMqEndpoint.send" do

  before(:each) do
    @uri = URI.parse('rabbitmq://localhost/rme.spec')
    @endpoint = MassTransit::EndpointFactory.getEndpoint(@uri)
    @endpoint.should_not be_nil
  end

  it "should place the message on the queue" do

    q = Carrot.queue(@uri.path)

    @endpoint.send "blah"

    # need to wait a moment for this to actually happen, good thing .pop blocks
    #q.message_count.should be > 1

    msg = q.pop(:ack => false)
    msg.to_s.should eql "blah"

    Carrot.stop

  end

  it "should not place the message on the queue if the message is nil"

end
